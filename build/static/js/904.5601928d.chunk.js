"use strict";(self.webpackChunkioms_web=self.webpackChunkioms_web||[]).push([[904],{19239:function(e,n,t){t.d(n,{Z:function(){return C}});var o=t(93433),r=t(74165),l=t(37762),i=t(15861),a=t(29439),c=t(47313),s=t(84697),u=t(9019),p=t(70501),d=t(98466),f=t(69918),g=t(40621),h=t(63669),m=t(19768),v=t(95823),x=t(18855),Z=t(46417),w=function(e){var n=e.pets,t=e.setPet,o=e.current_pet,r=void 0===o?{}:o;return(0,Z.jsx)(v.C.Group,{children:n.map((function(e,n){return(0,Z.jsx)("a",{href:"#",onClick:function(){console.log("Current",r,e,r===e),null!==r?r.id!==e.id&&t(e):t(e)},children:(0,Z.jsx)(x.Z,{title:e.name,placement:"top",children:(0,Z.jsx)(v.C,{style:{backgroundColor:"#87d068"},src:(0,h.l)(e.icon),children:e.name.charAt(0).toUpperCase()})})},n)}))})},k=t(41209),y=t(37753),C=function(e){var n=e.real_time,t=void 0!==n&&n,v=e.title,x=void 0===v?"Pet History":v,C=(0,c.useState)(),P=(0,a.Z)(C,2),j=P[0],b=P[1],S=(0,c.useState)("Population"),_=(0,a.Z)(S,2),R=_[0],M=_[1],O=(0,c.useState)([]),L=(0,a.Z)(O,2),E=L[0],T=L[1],I=(0,c.useState)(null),A=(0,a.Z)(I,2),W=A[0],G=A[1],H=(0,c.useState)([]),N=(0,a.Z)(H,2),F=N[0],U=N[1],z=(0,c.useState)([]),D=(0,a.Z)(z,2),J=D[0],Y=D[1],q=(0,c.useState)(!0),B=(0,a.Z)(q,2),K=B[0],Q=B[1],V=(0,c.useState)(null),X=(0,a.Z)(V,2),$=X[0],ee=X[1],ne=(0,c.useRef)(null),te=(0,c.useRef)(null),oe=function(){console.log("Cleariing polys",F),F.forEach((function(e){return e.polyline.setMap(null)}))},re=function(){J.forEach((function(e){return e.setMap(null)}))};function le(e){return ie.apply(this,arguments)}function ie(){return(ie=(0,i.Z)((0,r.Z)().mark((function e(n){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,m.RT)(n.id);case 3:return t=e.sent,console.log(t),e.abrupt("return",t.results);case 8:return e.prev=8,e.t0=e.catch(0),console.log(e.t0),e.abrupt("return",[]);case 12:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}var ae=function(){var e=(0,i.Z)((0,r.Z)().mark((function e(n,t,o,i){var a,c,s,u,p;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===W){e.next=9;break}return e.next=3,le(W);case 3:a=e.sent,re(),oe(),"Population"===R?(ce(n,t,o,a,W.color),Q(!1)):(a.length>0&&se(n,t,a.map((function(e){return{lat:e.latitudes,lng:e.longitudes}})),W.color,W.id),Q(!1)),e.next=34;break;case 9:console.log("Here at all"),c=(0,l.Z)(i),e.prev=11,c.s();case 13:if((s=c.n()).done){e.next=25;break}return u=s.value,console.log("The Pet",u),oe(),re(),e.next=20,le(u);case 20:p=e.sent,console.log("Pet iter",u),"Population"===R?ce(n,t,o,p,u.color):se(n,t,p.map((function(e){return{lat:e.latitudes,lng:e.longitudes}})),u.color,u.id);case 23:e.next=13;break;case 25:e.next=30;break;case 27:e.prev=27,e.t0=e.catch(11),c.e(e.t0);case 30:return e.prev=30,c.f(),e.finish(30);case 33:Q(!1);case 34:case"end":return e.stop()}}),e,null,[[11,27,30,33]])})));return function(n,t,o,r){return e.apply(this,arguments)}}(),ce=function(e,n,t,r,l){var i=r.map((function(o,r){return new e.maps.Marker({position:{lat:o.latitudes,lng:o.longitudes},map:n,title:"At ".concat((0,h.gg)(o.created_at)),icon:{path:t.SymbolPath.CIRCLE,scale:3,fillColor:l,fillOpacity:1,strokeWeight:0}})}));Y((function(e){return(0,o.Z)(e).concat(i)}))},se=function(e,n,t,r,l){var i=new e.maps.Polyline({path:t,geodesic:!0,strokeColor:r,strokeOpacity:1,strokeWeight:2});i.setMap(n),U((function(e){return[].concat((0,o.Z)(e),[{pet_id:l,polyline:i}])}))},ue=function e(n,t,o,r){var l=new WebSocket(k.D.socketURL+"ws/ws-pet-tracker");ee(l),l.onopen=function(e){},l.onmessage=function(e){var l=JSON.parse(e.data);if(console.log("Data:",l),null!==l){var i=l.pet_location;pe(i,n,t,o,r)}},l.onclose=function(l){l.wasClean||e(n,t,o,r)},l.onerror=function(l){e(n,t,o,r)}},pe=function(e,n,t,r,l){if(console.log("Here at socketManager",F),"Route"===R)U((function(n){return n.map((function(n){if(n.pet_id===e.pet.id){console.log(n.polyline);var t=n.polyline.getPath();console.log("New Path",t),t.push({lat:e.latitudes,lng:e.longitudes}),n.polyline.setPath(t)}return n}))}));else{console.log("Color",l.find((function(n){return n.id===e.pet.id})).color),function(e,n){Y((function(t){return t[t.length-1].setIcon({path:e.SymbolPath.CIRCLE,scale:3,fillColor:n,fillOpacity:1,strokeWeight:0}),t}))}(r,l.find((function(n){return n.id===e.pet.id})).color);var i={url:(0,h.l)(e.pet.icon,"circle"),scaledSize:new n.maps.Size(30,30),anchor:new n.maps.Point(10,10),shape:{coords:[10,10,10],type:"circle"}},a=new n.maps.Marker({position:{lat:e.latitudes,lng:e.longitudes},map:t,title:"At ".concat((0,h.gg)(e.created_at)),icon:i});t.panTo(new n.maps.LatLng(e.latitudes,e.longitudes)),Y((function(e){return[].concat((0,o.Z)(e),[a])}))}};return(0,c.useEffect)((function(){(0,h.pf)(T,(function(e){return function(e){if(Q(!0),ne.current){console.log(ne.current);var n=window.google,o=ne.current,r=te.current;ae(n,o,r,e).then((function(l){null===$&&t&&(ee("Hello"),ue(n,o,r,e))}))}}(e)}))}),[j,R,W]),(0,Z.jsx)(Z.Fragment,{children:(0,Z.jsx)(g.Z,{title:(0,Z.jsx)(Z.Fragment,{children:(0,Z.jsxs)(u.ZP,{container:!0,spacing:3,alignItems:"center",children:[(0,Z.jsx)(u.ZP,{item:!0,children:x}),(0,Z.jsx)(u.ZP,{item:!0,xs:12,md:6,lg:4,sx:{ml:"auto"},children:(0,Z.jsx)(w,{pets:E,setPet:G,current_pet:W})}),(0,Z.jsx)(u.ZP,{children:(0,Z.jsx)(d.Z,{options:["Population","Route"],value:R,onChange:M})})]})}),children:(0,Z.jsx)(f.Z,{tip:"Constructing data...",spinning:K,children:(0,Z.jsx)(p.Z,{children:(0,Z.jsx)("div",{style:{height:"70vh",width:"100%"},children:(0,Z.jsx)(s.ZP,{defaultCenter:{lat:-6.804358,lng:39.222483},defaultZoom:17,yesIWantToUseGoogleMapApiInternals:!0,onGoogleApiLoaded:function(e){var n=e.map,t=e.maps;ne.current=n,te.current=t,b(!0)},children:j&&(0,Z.jsx)(y.j_,{onLoad:function(e){console.log("Ready",e)},drawingMode:"polygon",drawingControlOptions:{position:window.google.maps.ControlPosition.TOP_CENTER,drawingModes:[window.google.maps.drawing.OverlayType.POLYGON]}})})})})})})})}},65904:function(e,n,t){t.r(n);var o=t(19239),r=t(46417);n.default=function(){return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(o.Z,{})})}}}]);