"use strict";(self.webpackChunkioms_web=self.webpackChunkioms_web||[]).push([[904],{19239:function(e,n,t){t.d(n,{Z:function(){return y}});var o=t(93433),r=t(74165),l=t(37762),i=t(15861),a=t(29439),s=t(47313),c=t(84697),u=t(9019),p=t(70501),f=t(98466),d=t(69918),g=t(40621),h=t(63669),m=t(19768),v=t(95823),x=t(18855),Z=t(46417),w=function(e){var n=e.pets,t=e.setPet,o=e.current_pet,r=void 0===o?{}:o;return(0,Z.jsx)(v.C.Group,{children:n.map((function(e,n){return(0,Z.jsx)("a",{href:"#",onClick:function(){console.log("Current",r,e,r===e),null!==r?r.id!==e.id&&t(e):t(e)},children:(0,Z.jsx)(x.Z,{title:e.name,placement:"top",children:(0,Z.jsx)(v.C,{style:{backgroundColor:"#87d068"},src:(0,h.l)(e.icon),children:e.name.charAt(0).toUpperCase()})})},n)}))})},k=t(41209),C=t(37753),y=function(e){var n=e.real_time,t=void 0!==n&&n,v=e.title,x=void 0===v?"Pet History":v,y=(0,s.useState)(),P=(0,a.Z)(y,2),j=P[0],b=P[1],S=(0,s.useState)("Population"),R=(0,a.Z)(S,2),_=R[0],M=R[1],O=(0,s.useState)([]),E=(0,a.Z)(O,2),L=E[0],T=E[1],I=(0,s.useState)(null),W=(0,a.Z)(I,2),G=W[0],H=W[1],N=(0,s.useState)([]),A=(0,a.Z)(N,2),F=A[0],U=A[1],D=(0,s.useState)([]),J=(0,a.Z)(D,2),Y=J[0],q=J[1],z=(0,s.useState)(!0),B=(0,a.Z)(z,2),K=B[0],Q=B[1],V=(0,s.useState)(null),X=(0,a.Z)(V,2),$=X[0],ee=X[1],ne=(0,s.useRef)(null),te=(0,s.useRef)(null),oe=function(){console.log("Cleariing polys",F),F.forEach((function(e){return e.polyline.setMap(null)}))},re=function(){Y.forEach((function(e){return e.setMap(null)}))};function le(e){return ie.apply(this,arguments)}function ie(){return(ie=(0,i.Z)((0,r.Z)().mark((function e(n){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,m.RT)(n.id);case 3:return t=e.sent,console.log(t),e.abrupt("return",t.results);case 8:return e.prev=8,e.t0=e.catch(0),console.log(e.t0),e.abrupt("return",[]);case 12:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}var ae=function(){var e=(0,i.Z)((0,r.Z)().mark((function e(n,t,o,i){var a,s,c,u,p;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===G){e.next=9;break}return e.next=3,le(G);case 3:a=e.sent,re(),oe(),"Population"===_?(se(n,t,o,a,G.color),Q(!1)):(a.length>0&&ce(n,t,a.map((function(e){return{lat:e.latitudes,lng:e.longitudes}})),G.color,G.id),Q(!1)),e.next=34;break;case 9:console.log("Here at all"),s=(0,l.Z)(i),e.prev=11,s.s();case 13:if((c=s.n()).done){e.next=25;break}return u=c.value,console.log("The Pet",u),oe(),re(),e.next=20,le(u);case 20:p=e.sent,console.log("Pet iter",u),"Population"===_?se(n,t,o,p,u.color):ce(n,t,p.map((function(e){return{lat:e.latitudes,lng:e.longitudes}})),u.color,u.id);case 23:e.next=13;break;case 25:e.next=30;break;case 27:e.prev=27,e.t0=e.catch(11),s.e(e.t0);case 30:return e.prev=30,s.f(),e.finish(30);case 33:Q(!1);case 34:case"end":return e.stop()}}),e,null,[[11,27,30,33]])})));return function(n,t,o,r){return e.apply(this,arguments)}}(),se=function(e,n,t,r,l){var i=r.map((function(o,r){return new e.maps.Marker({position:{lat:o.latitudes,lng:o.longitudes},map:n,title:"Start",icon:{path:t.SymbolPath.CIRCLE,scale:3,fillColor:l,fillOpacity:1,strokeWeight:0}})}));q((function(e){return(0,o.Z)(e).concat(i)}))},ce=function(e,n,t,r,l){var i=new e.maps.Polyline({path:t,geodesic:!0,strokeColor:r,strokeOpacity:1,strokeWeight:2});i.setMap(n),U((function(e){return[].concat((0,o.Z)(e),[{pet_id:l,polyline:i}])}))},ue=function e(n,t,o,r){var l=new WebSocket(k.D.socketURL+"ws/ws-pet-tracker");ee(l),l.onopen=function(e){},l.onmessage=function(e){var l=JSON.parse(e.data);if(console.log("Data:",l),null!==l){var i=l.pet_location;pe(i,n,t,o,r)}},l.onclose=function(l){l.wasClean||e(n,t,o,r)},l.onerror=function(l){e(n,t,o,r)}},pe=function(e,n,t,r,l){if(console.log("Here at socketManager",F),"Route"===_)U((function(n){return n.map((function(n){if(n.pet_id===e.pet.id){console.log(n.polyline);var t=n.polyline.getPath();console.log("New Path",t),t.push({lat:e.latitudes,lng:e.longitudes}),n.polyline.setPath(t)}return n}))}));else{console.log("Color",l.find((function(n){return n.id===e.pet.id})).color);var i=new n.maps.Marker({position:{lat:e.latitudes,lng:e.longitudes},map:t,title:"Start",icon:{path:r.SymbolPath.CIRCLE,scale:3,fillColor:l.find((function(n){return n.id===e.pet.id})).color,fillOpacity:1,strokeWeight:0}});q((function(e){return[].concat((0,o.Z)(e),[i])}))}};return(0,s.useEffect)((function(){(0,h.pf)(T,(function(e){return function(e){if(Q(!0),ne.current){console.log(ne.current);var n=window.google,o=ne.current,r=te.current;ae(n,o,r,e).then((function(l){null===$&&t&&(ee("Hello"),ue(n,o,r,e))}))}}(e)}))}),[j,_,G]),(0,Z.jsx)(Z.Fragment,{children:(0,Z.jsx)(g.Z,{title:(0,Z.jsx)(Z.Fragment,{children:(0,Z.jsxs)(u.ZP,{container:!0,spacing:3,alignItems:"center",children:[(0,Z.jsx)(u.ZP,{item:!0,children:x}),(0,Z.jsx)(u.ZP,{item:!0,xs:12,md:6,lg:4,sx:{ml:"auto"},children:(0,Z.jsx)(w,{pets:L,setPet:H,current_pet:G})}),(0,Z.jsx)(u.ZP,{children:(0,Z.jsx)(f.Z,{options:["Population","Route"],value:_,onChange:M})})]})}),children:(0,Z.jsx)(d.Z,{tip:"Constructing data...",spinning:K,children:(0,Z.jsx)(p.Z,{children:(0,Z.jsx)("div",{style:{height:"70vh",width:"100%"},children:(0,Z.jsx)(c.ZP,{defaultCenter:{lat:-6.804358,lng:39.222483},defaultZoom:20,yesIWantToUseGoogleMapApiInternals:!0,onGoogleApiLoaded:function(e){var n=e.map,t=e.maps;ne.current=n,te.current=t,b(!0)},children:j&&(0,Z.jsx)(C.j_,{onLoad:function(e){console.log("Ready",e)},drawingMode:"polygon",drawingControlOptions:{position:window.google.maps.ControlPosition.TOP_CENTER,drawingModes:[window.google.maps.drawing.OverlayType.POLYGON]}})})})})})})})}},65904:function(e,n,t){t.r(n);var o=t(19239),r=t(46417);n.default=function(){return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(o.Z,{})})}}}]);